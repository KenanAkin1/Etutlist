@{
    ViewData["Title"] = "Akýllý Toplu Telafi";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-lightning-charge-fill"></i> Akýllý Toplu Telafi Sistemi</h2>
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Geri
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            <pre style="margin: 0; white-space: pre-wrap; font-family: monospace;">@TempData["Success"]</pre>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-calendar-x"></i> Hangi Günün Dersleri Telafi Edilecek?</h5>
        </div>
        <div class="card-body">
            <div class="alert alert-info">
                <i class="bi bi-info-circle-fill"></i> <strong>Sistem Nasýl Çalýþýr?</strong>
                <ol class="mt-2 mb-0">
                    <li><strong>Tarih</strong> seçin (örn: 17.11.2025 Pazartesi)</li>
                    <li>O günkü <strong>tüm derslerini</strong> sistem otomatik bulacak</li>
                    <li>Her ders için <strong>çakýþma kontrolü yaparak</strong> uygun slot arayacak</li>
                    <li>Uygun hocanýn <strong>müsait olduðu saatlere</strong> otomatik atacak</li>
                    <li>Sonuçlarý <strong>detaylý rapor</strong> olarak sunacak</li>
                </ol>
            </div>

            <form asp-action="TopluTelafiOlustur" method="post">
                @Html.AntiForgeryToken()

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            <i class="bi bi-calendar-x"></i> Telafi Edilecek Tarih <span class="text-danger">*</span>
                        </label>
                        <input type="date" name="telafiYapilacakTarih" class="form-control form-control-lg" 
                               value="@DateTime.Today.ToString("yyyy-MM-dd")" required />
                        <small class="text-muted d-block mt-1">
                            <strong>Örnek:</strong> 17.11.2025 Pazartesi seçerseniz, o günün tüm dersleri telafi edilecek
                        </small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            <i class="bi bi-chat-left-text"></i> Telafi Nedeni <span class="text-danger">*</span>
                        </label>
                        <input type="text" name="telafiNedeni" class="form-control form-control-lg" 
                               placeholder="Örn: Resmi tatil, Toplantý, vb." required />
                        <small class="text-muted d-block mt-1">
                            Telafi nedenini açýklayýn
                        </small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card bg-light border-0">
                        <div class="card-body">
                            <label class="form-label fw-bold mb-3">
                                <i class="bi bi-clock-history"></i> Telafi Edilecek Ders Saatleri
                            </label>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="tumSaatler" checked onchange="toggleSaatler(this)">
                                <label class="form-check-label fw-bold" for="tumSaatler">
                                    Tüm Günün Derslerini Telafi Et
                                </label>
                            </div>

                            <hr class="my-2">

                            <div class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-2" id="saatListesi">
                                @for (int i = 1; i <= 9; i++)
                                {
                                    <div class="col">
                                        <div class="form-check">
                                            <input class="form-check-input ders-saati" type="checkbox" name="secilenSaatler"
                                                   value="@i" id="saat_@i" checked>
                                            <label class="form-check-label" for="saat_@i">
                                                @i. Ders
                                            </label>
                                        </div>
                                    </div>
                                }
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <i class="bi bi-info-circle"></i> Seçili gün içinde sadece iþaretlediðiniz saatlere denk gelen dersler için telafi aranýr.
                            </small>
                        </div>
                    </div>
                </div>

                <script>
                    function toggleSaatler(source) {
                        var checkboxes = document.querySelectorAll('.ders-saati');
                        for(var i=0, n=checkboxes.length;i<n;i++) {
                            checkboxes[i].checked = source.checked;
                        }
                    }
                </script>
                <div class="alert alert-warning mt-4">
                    <h6><i class="bi bi-exclamation-triangle-fill"></i> <strong>Akýllý Planlama Kurallarý:</strong></h6>
                    <ul class="mb-0">
                        <li>? <strong>Ayný kýsýma</strong> ayný gün/saatte baþka telafi atanmaz</li>
                        <li>? <strong>Ayný hocaya</strong> ayný gün/saatte baþka ders atanmaz</li>
                        <li>? <strong>Tabur ayarlarý</strong> dikkate alýnýr (baþlama saati, atlanacak saatler)</li>
                        <li>? <strong>Çakýþma yoksa</strong> otomatik olarak uygun slota atar</li>
                        <li>?? Uygun slot bulunamazsa o ders <strong>atlanýr</strong></li>
                    </ul>
                </div>

                <div class="mt-4 d-flex gap-2 justify-content-end">
                    <a asp-action="Index" class="btn btn-secondary btn-lg">
                        <i class="bi bi-x-circle"></i> Ýptal
                    </a>
                    <button type="submit" class="btn btn-success btn-lg" 
                            onclick="return confirm('?? Akýllý toplu telafi baþlatýlacak. Sistem otomatik olarak uygun slotlarý bulacak. Emin misiniz?');">
                        <i class="bi bi-lightning-fill"></i> Baþlat
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Örnek Senaryo -->
    <div class="card mt-3 shadow-sm">
        <div class="card-header bg-success text-white">
            <h6 class="mb-0"><i class="bi bi-bookmark-check"></i> Örnek Kullaným Senaryosu</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-primary"><i class="bi bi-1-circle-fill"></i> Giriþ Verileri:</h6>
                    <ul>
                        <li><strong>Tarih:</strong> 17.11.2025 (Pazartesi)</li>
                        <li><strong>Neden:</strong> Resmi Tatil</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6 class="text-success"><i class="bi bi-2-circle-fill"></i> Sistem Ýþlemleri:</h6>
                    <ol>
                        <li>Pazartesi derslerini bulur (örn: 25 ders)</li>
                        <li>Her tabur için telafi takvimi oluþturur</li>
                        <li>Çakýþma olmayan slotlara atar</li>
                        <li>Rapor: ? 22 baþarýlý, ? 3 baþarýsýz</li>
                    </ol>
                </div>
            </div>
            
            <div class="alert alert-light mt-3 mb-0">
                <h6 class="text-info"><i class="bi bi-graph-up"></i> Örnek Rapor:</h6>
                <pre class="mb-0" style="font-family: monospace; font-size: 0.9em;">? Akýllý Toplu Telafi Tamamlandý!

?? Ýstatistik:
  • Baþarýlý: 22
  • Baþarýsýz: 3

?? Hatalar:
- Fizik (Kýsým 5): Uygun slot bulunamadý
- Kimya (Kýsým 12): Müsait hoca bulunamadý
- Matematik (Kýsým 8): Max ders saati (9) aþýldý</pre>
            </div>
        </div>
    </div>

    <!-- Bilgilendirme ve Ayarlar -->
    <div class="row mt-3">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="bi bi-info-circle"></i> Ön Gereksinimler</h6>
                </div>
                <div class="card-body">
                    <p class="mb-2">Sistem çalýþmasý için þunlar gerekli:</p>
                    <ul class="mb-0">
                        <li><strong>Tabur:</strong> Fakülte için en az 1 tabur tanýmlý olmalý</li>
                        <li><strong>Telafi Ayarlarý:</strong> Tabur için telafi ayarlarý yapýlmýþ olmalý</li>
                        <li><strong>Ders Programý:</strong> Normal ders programý girilmiþ olmalý</li>
                        <li><strong>Hocalar:</strong> Aktif hocalar ve ders yetkileri tanýmlý olmalý</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0"><i class="bi bi-gear"></i> Hýzlý Ayarlar</h6>
                </div>
                <div class="card-body">
                    <p class="mb-3">Telafi sistemini yapýlandýrýn:</p>
                    <div class="d-grid gap-2">
                        <a asp-controller="Ayarlar" asp-action="TelafiAyarlari" class="btn btn-outline-primary">
                            <i class="bi bi-gear-fill"></i> Tabur ve Telafi Ayarlarý
                        </a>
                        <a asp-controller="DersProgrami" asp-action="Index" class="btn btn-outline-secondary">
                            <i class="bi bi-calendar3"></i> Ders Programý
                        </a>
                        <a asp-controller="Ayarlar" asp-action="Index" class="btn btn-outline-success">
                            <i class="bi bi-person-badge"></i> Hoca ve Fakülte Ayarlarý
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
